"use strict";(()=>{var Me=Object.defineProperty;var De=(n,e,t)=>e in n?Me(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var f=(n,e,t)=>De(n,typeof e!="symbol"?e+"":e,t);var ie="America/Los_Angeles",Ve=new Intl.DateTimeFormat("en-US",{weekday:"short",month:"short",day:"numeric",timeZone:ie}),_e=new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",hour12:!0,timeZone:ie}),se=n=>{let e=new Date(n);return Ve.format(e)},ce=n=>{let e=new Date(n);return _e.format(e)},g=(n,e="USD")=>n==null?"":new Intl.NumberFormat("en-US",{style:"currency",currency:e,maximumFractionDigits:2}).format(n);var b=(n,e,t)=>{let r=n.querySelector(`[data-field="${e}"]`);if(!r){console.warn(`Element with data-field="${e}" not found`);return}r.textContent=t};var C="GraphQL Client";var B="An error occurred while fetching from the API. Review 'graphQLErrors' for details.",$="Response returned unexpected Content-Type:",O="An unknown error has occurred. The API did not return a data object or any errors in its response.",q={json:"application/json",multipart:"multipart/mixed"},F="X-SDK-Variant",Q="X-SDK-Version",de="shopify-graphql-client",ue="1.4.1",R=1e3,me=[429,503],G=/@(defer)\b/i,le=`\r
`,pe=/boundary="?([^=";]+)"?/i,K=le+le;function v(n,e=C){return n.startsWith(`${e}`)?n:`${e}: ${n}`}function T(n){return n instanceof Error?n.message:JSON.stringify(n)}function j(n){return n instanceof Error&&n.cause?n.cause:void 0}function X(n){return n.flatMap(({errors:e})=>e??[])}function x({client:n,retries:e}){if(e!==void 0&&(typeof e!="number"||e<0||e>3))throw new Error(`${n}: The provided "retries" value (${e}) is invalid - it cannot be less than ${0} or greater than ${3}`)}function h(n,e){return e&&(typeof e!="object"||Array.isArray(e)||typeof e=="object"&&Object.keys(e).length>0)?{[n]:e}:{}}function W(n,e){if(n.length===0)return e;let r={[n.pop()]:e};return n.length===0?r:W(n,r)}function ye(n,e){return Object.keys(e||{}).reduce((t,r)=>(typeof e[r]=="object"||Array.isArray(e[r]))&&n[r]?(t[r]=ye(n[r],e[r]),t):(t[r]=e[r],t),Array.isArray(n)?[...n]:{...n})}function Y([n,...e]){return e.reduce(ye,{...n})}function J({clientLogger:n,customFetchApi:e=fetch,client:t=C,defaultRetryWaitTime:r=R,retriableCodes:a=me}){let o=async(i,c,s)=>{let l=c+1,u=s+1,d;try{if(d=await e(...i),n({type:"HTTP-Response",content:{requestParams:i,response:d}}),!d.ok&&a.includes(d.status)&&l<=u)throw new Error;let m=d?.headers.get("X-Shopify-API-Deprecated-Reason")||"";return m&&n({type:"HTTP-Response-GraphQL-Deprecation-Notice",content:{requestParams:i,deprecationNotice:m}}),d}catch(m){if(l<=u){let p=d?.headers.get("Retry-After");return await ke(p?parseInt(p,10):r),n({type:"HTTP-Retry",content:{requestParams:i,lastResponse:d,retryAttempt:c,maxRetries:s}}),o(i,l,s)}throw new Error(v(`${s>0?`Attempted maximum number of ${s} network retries. Last message - `:""}${T(m)}`,t))}};return o}async function ke(n){return new Promise(e=>setTimeout(e,n))}function Z({headers:n,url:e,customFetchApi:t=fetch,retries:r=0,logger:a}){x({client:C,retries:r});let o={headers:n,url:e,retries:r},i=He(a),c=J({customFetchApi:t,clientLogger:i,defaultRetryWaitTime:R}),s=Pe(c,o),l=Ue(s),u=Ke(s);return{config:o,fetch:s,request:l,requestStream:u}}function He(n){return e=>{n&&n(e)}}async function Ee(n){let{errors:e,data:t,extensions:r}=await n.json();return{...h("data",t),...h("extensions",r),headers:n.headers,...e||!t?{errors:{networkStatusCode:n.status,message:v(e?B:O),...h("graphQLErrors",e),response:n}}:{}}}function Pe(n,{url:e,headers:t,retries:r}){return async(a,o={})=>{let{variables:i,headers:c,url:s,retries:l,keepalive:u,signal:d}=o,m=JSON.stringify({query:a,variables:i});x({client:C,retries:l});let p=Object.entries({...t,...c}).reduce((E,[A,I])=>(E[A]=Array.isArray(I)?I.join(", "):I.toString(),E),{});return!p[F]&&!p[Q]&&(p[F]=de,p[Q]=ue),n([s??e,{method:"POST",headers:p,body:m,signal:d,keepalive:u}],1,l??r)}}function Ue(n){return async(...e)=>{if(G.test(e[0]))throw new Error(v("This operation will result in a streamable response - use requestStream() instead."));let t=null;try{t=await n(...e);let{status:r,statusText:a}=t,o=t.headers.get("content-type")||"";return t.ok?o.includes(q.json)?await Ee(t):{errors:{networkStatusCode:r,message:v(`${$} ${o}`),response:t}}:{errors:{networkStatusCode:r,message:v(a),response:t}}}catch(r){return{errors:{message:T(r),...t==null?{}:{networkStatusCode:t.status,response:t}}}}}}async function*Be(n){let e=new TextDecoder;if(n.body[Symbol.asyncIterator])for await(let t of n.body)yield e.decode(t);else{let t=n.body.getReader(),r;try{for(;!(r=await t.read()).done;)yield e.decode(r.value)}finally{t.cancel()}}}function $e(n,e){return{async*[Symbol.asyncIterator](){try{let t="";for await(let r of n)if(t+=r,t.indexOf(e)>-1){let a=t.lastIndexOf(e),i=t.slice(0,a).split(e).filter(c=>c.trim().length>0).map(c=>c.slice(c.indexOf(K)+K.length).trim());i.length>0&&(yield i),t=t.slice(a+e.length),t.trim()==="--"&&(t="")}}catch(t){throw new Error(`Error occured while processing stream payload - ${T(t)}`)}}}}function Oe(n){return{async*[Symbol.asyncIterator](){yield{...await Ee(n),hasNext:!1}}}}function Fe(n){return n.map(e=>{try{return JSON.parse(e)}catch(t){throw new Error(`Error in parsing multipart response - ${T(t)}`)}}).map(e=>{let{data:t,incremental:r,hasNext:a,extensions:o,errors:i}=e;if(!r)return{data:t||{},...h("errors",i),...h("extensions",o),hasNext:a};let c=r.map(({data:s,path:l,errors:u})=>({data:s&&l?W(l,s):{},...h("errors",u)}));return{data:c.length===1?c[0].data:Y([...c.map(({data:s})=>s)]),...h("errors",X(c)),hasNext:a}})}function Qe(n,e){if(n.length>0)throw new Error(B,{cause:{graphQLErrors:n}});if(Object.keys(e).length===0)throw new Error(O)}function Ge(n,e){let t=(e??"").match(pe),r=`--${t?t[1]:"-"}`;if(!n.body?.getReader&&!n.body?.[Symbol.asyncIterator])throw new Error("API multipart response did not return an iterable body",{cause:n});let a=Be(n),o={},i;return{async*[Symbol.asyncIterator](){try{let c=!0;for await(let s of $e(a,r)){let l=Fe(s);i=l.find(d=>d.extensions)?.extensions??i;let u=X(l);o=Y([o,...l.map(({data:d})=>d)]),c=l.slice(-1)[0].hasNext,Qe(u,o),yield{...h("data",o),...h("extensions",i),hasNext:c}}if(c)throw new Error("Response stream terminated unexpectedly")}catch(c){let s=j(c);yield{...h("data",o),...h("extensions",i),errors:{message:v(T(c)),networkStatusCode:n.status,...h("graphQLErrors",s?.graphQLErrors),response:n},hasNext:!1}}}}}function Ke(n){return async(...e)=>{if(!G.test(e[0]))throw new Error(v("This operation does not result in a streamable response - use request() instead."));try{let t=await n(...e),{statusText:r}=t;if(!t.ok)throw new Error(r,{cause:t});let a=t.headers.get("content-type")||"";switch(!0){case a.includes(q.json):return Oe(t);case a.includes(q.multipart):return Ge(t,a);default:throw new Error(`${$} ${a}`,{cause:t})}}catch(t){return{async*[Symbol.asyncIterator](){let r=j(t);yield{errors:{message:v(T(t)),...h("networkStatusCode",r?.status),...h("response",r)},hasNext:!1}}}}}}function z({client:n,storeDomain:e}){try{if(!e||typeof e!="string")throw new Error;let t=e.trim(),r=t.match(/^https?:/)?t:`https://${t}`,a=new URL(r);return a.protocol="https",a.origin}catch(t){throw new Error(`${n}: a valid store domain ("${e}") must be provided`,{cause:t})}}function N({client:n,currentSupportedApiVersions:e,apiVersion:t,logger:r}){let a=`${n}: the provided apiVersion ("${t}")`,o=`Currently supported API versions: ${e.join(", ")}`;if(!t||typeof t!="string")throw new Error(`${a} is invalid. ${o}`);let i=t.trim();e.includes(i)||(r?r({type:"Unsupported_Api_Version",content:{apiVersion:t,supportedApiVersions:e}}):console.warn(`${a} is likely deprecated or not supported. ${o}`))}function M(n){let e=n*3-2;return e===10?e:`0${e}`}function ee(n,e,t){let r=e-t;return r<=0?`${n-1}-${M(r+4)}`:`${n}-${M(r)}`}function ge(){let n=new Date,e=n.getUTCMonth(),t=n.getUTCFullYear(),r=Math.floor(e/3+1);return{year:t,quarter:r,version:`${t}-${M(r)}`}}function te(){let{year:n,quarter:e,version:t}=ge(),r=e===4?`${n+1}-01`:`${n}-${M(e+1)}`;return[ee(n,e,3),ee(n,e,2),ee(n,e,1),t,r,"unstable"]}function re(n){return e=>({...e??{},...n.headers})}function ne({getHeaders:n,getApiUrl:e}){return(t,r)=>{let a=[t];if(r&&Object.keys(r).length>0){let{variables:o,apiVersion:i,headers:c,retries:s,signal:l}=r;a.push({...o?{variables:o}:{},...c?{headers:n(c)}:{},...i?{url:e(i)}:{},...s?{retries:s}:{},...l?{signal:l}:{}})}return a}}var ae="application/json",ve="storefront-api-client",Te="1.0.9",Se="X-Shopify-Storefront-Access-Token",be="Shopify-Storefront-Private-Token",Ae="X-SDK-Variant",Ce="X-SDK-Version",Le="X-SDK-Variant-Source",L="Storefront API Client";function Ie(n){if(n&&typeof window<"u")throw new Error(`${L}: private access tokens and headers should only be used in a server-to-server implementation. Use the public API access token in nonserver environments.`)}function we(n,e){if(!n&&!e)throw new Error(`${L}: a public or private access token must be provided`);if(n&&e)throw new Error(`${L}: only provide either a public or private access token`)}function oe({storeDomain:n,apiVersion:e,publicAccessToken:t,privateAccessToken:r,clientName:a,retries:o=0,customFetchApi:i,logger:c}){let s=te(),l=z({client:L,storeDomain:n}),u={client:L,currentSupportedApiVersions:s,logger:c};N({...u,apiVersion:e}),we(t,r),Ie(r);let d=je(l,e,u),m={storeDomain:l,apiVersion:e,...t?{publicAccessToken:t}:{privateAccessToken:r},headers:{"Content-Type":ae,Accept:ae,[Ae]:ve,[Ce]:Te,...a?{[Le]:a}:{},...t?{[Se]:t}:{[be]:r}},apiUrl:d(),clientName:a},p=Z({headers:m.headers,url:m.apiUrl,retries:o,customFetchApi:i,logger:c}),y=re(m),E=Xe(m,d),A=ne({getHeaders:y,getApiUrl:E});return Object.freeze({config:m,getHeaders:y,getApiUrl:E,fetch:(...S)=>p.fetch(...A(...S)),request:(...S)=>p.request(...A(...S)),requestStream:(...S)=>p.requestStream(...A(...S))})}function je(n,e,t){return r=>{r&&N({...t,apiVersion:r});let a=(r??e).trim();return`${n}/api/${a}/graphql.json`}}function Xe(n,e){return t=>t?e(t):n.apiUrl}function We(n){if(!n)throw new Error("Invalid variant ID");return n.startsWith("gid://")?n:`gid://shopify/ProductVariant/${n}`}var Ye="ll-theme.myshopify.com",Je="b2506cf21eef17d954028e02a4f3eb46",Ze="2025-07",qe=oe({storeDomain:Ye,apiVersion:Ze,publicAccessToken:Je});async function Re(n){try{let{data:e,errors:t}=await qe.request(`
      query EventByHandle($handle: String!) {
        productByHandle(handle: $handle) {
          id
          title
          handle
          description
          gameType:  metafield(namespace:"custom", key:"game_type") { value }
          startTime: metafield(namespace:"custom", key:"start_time") { value }
          duration:  metafield(namespace:"custom", key:"duration") { value }
          format:    metafield(namespace:"custom", key:"format") { value }
          bandai:    metafield(namespace:"custom", key:"bandai_tcg") { value }
          complementaryProducts: metafield(namespace:"shopify--discovery--product_recommendation", key:"complementary_products") {
            references(first: 20) {
              edges { node { ... on Product { 
                id 
                title
                variants(first: 4) {
                  edges { node {
                    id 
                    title 
                    quantityAvailable
                    price { amount currencyCode }
                  }}
                }
              }}}
            }
          }
          variants(first: 50) {
            edges { node {
              id
              title
              quantityAvailable
              price { amount currencyCode }
              selectedOptions { name value }
            } }
          }
        }
      }
      `,{variables:{handle:n}});if(t)throw new Error(t.graphQLErrors?.[0]?.message||t.message);return e.productByHandle}catch(e){return console.error(`Error fetching event product with handle ${n}:`,e),null}}async function xe(n){try{let e=n.map(o=>({merchandiseId:We(o.merchandiseId),quantity:o.quantity,attributes:o.attributes||[]})),{data:t,errors:r}=await qe.request(`
      mutation cartCreate($input: CartInput) {
        cartCreate(input: $input) {
          cart { id checkoutUrl }
          userErrors { field message }
        }
      }
      `,{variables:{input:{lines:e}}});if(r)throw new Error(r.graphQLErrors?.[0]?.message||r.message);let a=t?.cartCreate?.userErrors;if(a?.length)throw new Error(a[0]?.message||"Cart create failed");return t?.cartCreate?.cart}catch(e){throw console.error("Error creating cart with lines:",e),e}}var D=class{constructor(e,t){f(this,"cartEl");f(this,"cartManager");this.cartManager=e,this.cartEl=t,this.hideCartItemTemplate()}update(e="USD"){if(!this.cartEl){console.error("Cart element not found");return}let t=this.cartEl.querySelector('[data-field="cart-items"]'),r=this.cartEl.querySelector('[data-field="cart-subtotal"]'),a=document.querySelector('[data-field="cart-line-item"]');if(!t||!r||!a){console.error("Required cart elements not found");return}console.info("Updating cart display"),this.hideTemplate(a),t.innerHTML="";let o=this.cartManager.getItems(),i=this.cartManager.getSubtotal();o.forEach(c=>{let s=this.createCartItemElement(a,c,e);t.appendChild(s)}),r.textContent=g(i,e)}hideTemplate(e){e.classList.add("hide")}hideCartItemTemplate(){let e=document.querySelector('[data-field="cart-line-item"]');e&&e.classList.add("hide")}createCartItemElement(e,t,r){let a=e.cloneNode(!0);a.classList.remove("hide");let o=a.querySelector('[data-field="cart-line-title"]');if(o){let l=t.quantity&&t.quantity>1?`${t.title} (${t.quantity}x)`:t.title;o.textContent=l}let i=a.querySelector('[data-field="cart-line-variant"]');i&&(i.textContent=t.variant);let c=a.querySelector('[data-field="cart-line-price"]');c&&(c.textContent=g(t.price,r));let s=a.querySelector('[data-role="cart-line-clear"]');return t.id!=="event"&&s?(s.classList.remove("hide"),s.addEventListener("click",()=>this.cartManager.removeItem(t.id))):s&&s.classList.add("hide"),a}};var V=class{constructor(e){f(this,"items",[]);f(this,"onUpdateCallback");this.onUpdateCallback=e}getItems(){return[...this.items]}getSubtotal(){return this.items.reduce((e,t)=>e+t.price,0)}updateEventItem(e,t,r,a){this.items=this.items.filter(o=>o.id!=="event"),this.items.push({id:"event",title:t,variant:r,price:a}),this.triggerUpdate()}addUpsellItem(e){let t=this.items.findIndex(r=>r.id===e.id);if(t>=0){let r=this.items[t];this.items[t]={...r,quantity:(r.quantity||1)+(e.quantity||1),price:e.price*((r.quantity||1)+(e.quantity||1))}}else this.items.push(e);return this.triggerUpdate(),!0}removeItem(e){this.items=this.items.filter(t=>t.id!==e),this.triggerUpdate()}triggerUpdate(){this.onUpdateCallback?.()}};var _=class{constructor(e){this.product=e;f(this,"state",{participant:"self",requirePlayerName:!1,requirePokemonId:!1,requireTcgAccount:!1});this.setupListeners(),this.updateFieldVisibility()}getState(){return{...this.state}}setupListeners(){let e=document.getElementById("self"),t=document.getElementById("other");e&&t&&(e.addEventListener("change",()=>{e.checked&&(this.state.participant="self",this.updateFieldVisibility())}),t.addEventListener("change",()=>{t.checked&&(this.state.participant="other",this.updateFieldVisibility())}),!e.checked&&!t.checked&&(e.checked=!0,this.state.participant="self"))}updateFieldVisibility(){this.updatePlayerNameFields(),this.updatePokemonIdField(),this.updateTcgAccountField()}updatePlayerNameFields(){let e=document.querySelector('[data-role="player-name"]');if(!e)return;let t=this.state.participant==="other";e.classList.toggle("hide",!t),this.state.requirePlayerName=t,e.querySelectorAll("input").forEach(a=>{a.required=t})}updatePokemonIdField(){let e=document.querySelector('[data-role="pokemon-id"]');if(!e)return;let t=(this.product.gameType?.value||"").toLowerCase()==="pokemon";e.classList.toggle("hide",!t),this.state.requirePokemonId=t;let r=e.querySelector("input");r&&(r.required=t)}updateTcgAccountField(){let e=document.querySelector('[data-role="tcg-account"]');if(!e)return;let t=!!this.product.bandai;e.classList.toggle("hide",!t),this.state.requireTcgAccount=t}validate(){if(this.state.requirePlayerName){let e=this.getFormValue("field-first-name"),t=this.getFormValue("field-last-name");if(!e){let r="Please enter the player's first name.";return this.showError(r),{valid:!1,error:r}}if(!t){let r="Please enter the player's last name.";return this.showError(r),{valid:!1,error:r}}}if(this.state.requirePokemonId&&!this.getFormValue("field-pokemon-id")){let t="Please enter your Pok\xE9mon ID.";return this.showError(t),{valid:!1,error:t}}if(this.state.requireTcgAccount&&!document.querySelector('input[name="tcg-account"]:checked')){let t="Please indicate if you have a TCG Plus account.";return this.showError(t),{valid:!1,error:t}}return{valid:!0}}showError(e){let t=document.querySelector('[data-role="error"]');t&&(t.textContent=e,t.classList.remove("hide"),setTimeout(()=>{t.classList.add("hide")},5e3))}getFormValue(e){return(document.querySelector(`[data-role="${e}"]`)?.value||"").trim()}};var k=class{constructor(e,t,r,a){this.product=e;this.cartManager=t;this.formManager=r;this.getChosenVariantId=a;f(this,"form");f(this,"submitBtn");f(this,"errBox");this.form=document.querySelector('[data-role="event-form"]'),this.submitBtn=document.querySelector('[data-role="submit"]'),this.errBox=document.querySelector('[data-role="error"]'),this.setupButtonStateManagement()}setupFormHandler(){if(!this.form){console.error("Form not found");return}this.form.addEventListener("submit",async e=>{e.preventDefault(),await this.handleFormSubmission()})}async handleFormSubmission(){this.clearErrors();let e=this.validateForm();if(!e.valid){this.showError(e.error||"Validation error");return}this.disableSubmitButton();try{let r=(await this.createEventCart())?.checkoutUrl;if(!r)throw new Error("Could not create checkout.");window.location.href=r}catch(t){console.error("[events] checkout error",t),this.showError("Something went wrong. Please try again."),this.enableSubmitButton()}}validateForm(){if(!this.getChosenVariantId()){let t="This event is sold out.";return this.showError(t),{valid:!1,error:t}}return this.formManager.validate()}async createEventCart(){let e=this.formManager.getState(),t=this.getFormValue("field-first-name"),r=this.getFormValue("field-last-name"),a=`${t} ${r}`.trim(),o=e.requirePokemonId?this.getFormValue("field-pokemon-id"):"",i="";if(e.requireTcgAccount){let l=document.getElementById("true"),u=document.getElementById("false");l?.checked&&(i="Yes"),u?.checked&&(i="No")}let c=[{merchandiseId:this.getChosenVariantId(),quantity:1,attributes:[{key:"Game",value:this.product.gameType?.value||""},{key:"Format",value:this.product.format?.value||""},{key:"Participant",value:e.participant.charAt(0).toUpperCase()+e.participant.slice(1)}]}];return e.participant==="other"&&t&&r&&c[0].attributes.push({key:"Player Name",value:a}),o&&c[0].attributes.push({key:"Pok\xE9mon ID",value:o}),i&&c[0].attributes.push({key:"TCG Plus Account",value:i}),this.cartManager.getItems().forEach(l=>{l.id!=="event"&&l.variantId&&c.push({merchandiseId:l.variantId,quantity:l.quantity||1,attributes:[]})}),xe(c)}setupButtonStateManagement(){this.enableSubmitButton(),this.form&&(this.form.addEventListener("input",()=>this.enableSubmitButton()),this.form.addEventListener("change",()=>this.enableSubmitButton())),document.addEventListener("visibilitychange",()=>{document.hidden||this.enableSubmitButton()}),window.addEventListener("focus",()=>this.enableSubmitButton())}enableSubmitButton(){this.submitBtn&&this.submitBtn.disabled&&(this.submitBtn.disabled=!1)}disableSubmitButton(){this.submitBtn&&(this.submitBtn.disabled=!0)}clearErrors(){this.errBox&&(this.errBox.textContent="",this.errBox.classList.add("hide"))}showError(e){this.errBox&&(this.errBox.textContent=e,this.errBox.classList.remove("hide"))}getFormValue(e){return(document.querySelector(`[data-role="${e}"]`)?.value||"").trim()}};var H=(n,e)=>{let t;return(...r)=>{clearTimeout(t),t=setTimeout(()=>n(...r),e)}};var P=class{constructor(e,t){this.product=e;this.cartManager=t;f(this,"variants",[]);f(this,"chosenVariantId",null);f(this,"hasSelectedVariant",!1);f(this,"currency");this.variants=(e.variants?.edges||[]).map(r=>r.node),this.currency=this.variants[0]?.price?.currencyCode||"USD"}async render(){let e=document.querySelector('[data-role="ticket"]'),t=e?.parentElement||null;if(!t||!e){console.error("Ticket template or container not found"),this.chosenVariantId=this.variants[0]?.id||null;return}e.classList.add("hide"),t.innerHTML="",[...this.variants].sort((a,o)=>{let i=Number(a.price?.amount||"0"),c=Number(o.price?.amount||"0");return i-c}).forEach(a=>{console.info("Creating ticket for variant",a),this.createTicketElement(a,e,t)})}getChosenVariantId(){return this.chosenVariantId}createTicketElement(e,t,r){let a=this.getVariantTitle(e);if(a==="Default Title"&&this.variants.length>1)return;let o=a==="Default Title"?"Single Entry":a,i=e.quantityAvailable||0,c=Number(e.price?.amount||"0"),s=t.cloneNode(!0);s.classList.remove("hide"),this.setTicketData(s,o,i,c),i<=0?(console.info("Setting up sold out ticket for variant",e),this.setupSoldOutTicket(s)):this.setupAvailableTicket(s,e,o),r.appendChild(s)}getVariantTitle(e){let t=e.title;if(e.selectedOptions&&e.selectedOptions.length>0){let r=e.selectedOptions.find(a=>a.name.toLowerCase()!=="title"&&a.value!=="Default Title");if(r)t=r.value;else{let a=e.selectedOptions.find(o=>o.name.toLowerCase()==="title"&&o.value!=="Default Title");a&&(t=a.value)}}return t}setTicketData(e,t,r,a){let o=e.querySelector('[data-field="variant-title"]'),i=e.querySelector('[data-field="seats"]'),c=e.querySelector('[data-field="price"]');o&&(o.textContent=t),i&&(i.textContent=r>0?`${r} seats left`:"Sold out"),c&&(c.textContent=a===0?"Free":g(a,this.currency))}setupSoldOutTicket(e){e.classList.add("sold-out"),e.setAttribute("tabindex","-1"),e.setAttribute("aria-disabled","true")}setupAvailableTicket(e,t,r){e.dataset.variantId=t.id,e.setAttribute("aria-pressed","false");let a=H(()=>{this.updateEventInCart(t,r)},150);this.addTicketEventListeners(e,t,r,a),this.hasSelectedVariant||(this.chosenVariantId=t.id,this.setActiveTicket(e),this.updateEventInCart(t,r),this.hasSelectedVariant=!0)}addTicketEventListeners(e,t,r,a){let o=t.quantityAvailable||0;e.addEventListener("click",()=>{o<=0||(this.chosenVariantId=t.id,this.setActiveTicket(e),a())}),e.addEventListener("keydown",i=>{o<=0||(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),this.chosenVariantId=t.id,this.setActiveTicket(e),a())})}setActiveTicket(e){document.querySelectorAll('[data-role="ticket"]').forEach(t=>{t.querySelector('[data-field="checkbox"]')?.classList.remove("is-active"),t.setAttribute("aria-pressed","false")}),e.querySelector('[data-field="checkbox"]')?.classList.add("is-active"),e.setAttribute("aria-pressed","true")}updateEventInCart(e,t){let r=Number(e.price?.amount||"0");this.cartManager.updateEventItem("event",this.product.title,t,r)}};var U=class{constructor(e,t){this.product=e;this.cartManager=t;f(this,"upsellProducts",[]);this.extractUpsells()}async render(){let e=document.querySelector('[data-role="upsell"]'),t=e?.parentElement;if(!this.upsellProducts.length||!t||!e){t?.parentElement&&t.parentElement.classList.add("hide");return}e.classList.add("hide"),t.innerHTML="",this.upsellProducts.forEach(r=>{this.createUpsellElement(r,e,t)})}extractUpsells(){this.upsellProducts=(this.product.complementaryProducts?.references?.edges||[]).map(e=>e.node).filter(e=>!!e?.id).map(e=>({id:e?.id,title:e?.title||"Add-on",variants:(e?.variants?.edges||[]).map(t=>t.node).filter(t=>!!t?.id).map(t=>({id:t?.id,title:t?.title??"Untitled Variant",price:t?.price,quantityAvailable:t?.quantityAvailable||0,selectedOptions:t?.selectedOptions||[]}))})).filter(e=>e.variants.length>0)}createUpsellElement(e,t,r){let a=t.cloneNode(!0);a.classList.remove("hide"),this.setProductTitle(a,e.title);let i=this.findDefaultVariant(e.variants);e.variants.length>1?this.createVariantSelector(a,e.variants,c=>{i=c,this.updateUpsellDisplay(a,c),this.setupUpsellControls(a,e.title,c)}):this.hideVariantSelector(a),i&&(this.updateUpsellDisplay(a,i),this.setupUpsellControls(a,e.title,i)),r.appendChild(a)}setProductTitle(e,t){let r=e.querySelector('[data-field="upsell-title"]');r&&(r.textContent=t)}findDefaultVariant(e){let t=e.filter(a=>a.quantityAvailable>0);return(t.length>0?t:e).sort((a,o)=>{let i=Number(a.price?.amount||"0"),c=Number(o.price?.amount||"0");return i-c})[0]||null}createVariantSelector(e,t,r){let a=e.querySelector('[data-field="upsell-variants"]'),o=e.querySelector('[data-field="upsell-variant-item"]');!a||!o||(o.classList.add("hide"),a.innerHTML="",t.forEach((i,c)=>{let s=o.cloneNode(!0);s.classList.remove("hide");let l=this.getVariantOptionText(i),u=s.querySelector("div");u&&(u.textContent=l),s.classList.add("variant-option"),s.setAttribute("role","button"),s.setAttribute("tabindex","0"),c===0?(s.classList.add("selected"),s.setAttribute("aria-pressed","true")):s.setAttribute("aria-pressed","false");let d=()=>{a.querySelectorAll(".variant-option").forEach(m=>{m.classList.remove("selected"),m.setAttribute("aria-pressed","false")}),s.classList.add("selected"),s.setAttribute("aria-pressed","true"),r(i)};s.addEventListener("click",d),s.addEventListener("keydown",m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),d())}),a.appendChild(s)}))}getVariantOptionText(e){let t=e.selectedOptions?.filter(r=>r.value!=="Default Title"&&r.name.toLowerCase()!=="title")||[];return t.length>0?t.map(r=>r.value).join(" / "):e.title==="Default Title"?"Standard":e.title}hideVariantSelector(e){let t=e.querySelector('[data-field="upsell-variants"]');t&&t.classList.add("hide")}updateUpsellDisplay(e,t){let r=Number(t.price?.amount||"0"),a=t.price?.currencyCode||"USD",o=t.quantityAvailable,i=e.querySelector('[data-field="upsell-price"]');i&&(i.textContent=g(r,a));let c=e.querySelector('[data-field="upsell-stock-count"]');c&&(c.textContent=o.toString());let s=e.querySelector('[data-field="upsell-stock"]');s&&(o>0&&o<=5?s.classList.remove("hide"):s.classList.add("hide")),o<=0?e.classList.add("sold-out"):e.classList.remove("sold-out")}setupUpsellControls(e,t,r){let a=Number(r.price?.amount||"0"),o=r.quantityAvailable,i=Math.min(10,o),c=`upsell_${r.id.split("/").pop()}`,s=this.getVariantOptionText(r),l=`${t} - ${s}`,u=e.querySelector('[data-field="upsell-add"]'),d=e.querySelector('[data-field="upsell-qty-up"]'),m=e.querySelector('[data-field="upsell-qty-down"]'),p=e.querySelector('[data-field="upsell-qty-count"]'),y=1;if(p&&(p.textContent=y.toString()),u){let w=u.cloneNode(!0);u.parentNode?.replaceChild(w,u)}if(d){let w=d.cloneNode(!0);d.parentNode?.replaceChild(w,d)}if(m){let w=m.cloneNode(!0);m.parentNode?.replaceChild(w,m)}let E=e.querySelector('[data-field="upsell-add"]'),A=e.querySelector('[data-field="upsell-qty-up"]'),I=e.querySelector('[data-field="upsell-qty-down"]');if(o<=0){this.disableUpsellControls(e);return}E?.classList.remove("disabled");let S=E?.querySelector(".button-text");S&&(S.textContent="Add to Cart"),A?.addEventListener("click",()=>{y<i&&(y++,p&&(p.textContent=y.toString()))}),I?.addEventListener("click",()=>{y>1&&(y--,p&&(p.textContent=y.toString()))});let Ne=H(()=>{this.addUpsellToCart(c,l,a,y,r)},300);E?.addEventListener("click",()=>{E.classList.contains("disabled")||(E.classList.add("processing"),Ne(),setTimeout(()=>{E.classList.remove("processing")},350))})}disableUpsellControls(e){let t=e.querySelector('[data-field="upsell-add"]'),r=e.querySelector('[data-field="upsell-qty-wrap"]');if(t){let a=t.querySelector(".button-text");a&&(a.textContent="Out of Stock"),t.classList.add("disabled")}r&&(r.style.opacity="0.5")}addUpsellToCart(e,t,r,a,o){let s=this.cartManager.getItems().find(d=>d.id===e)?.quantity||0;if(s+a>o.quantityAvailable){let d=o.quantityAvailable-s;if(d<=0){this.showInventoryError(t,"This item is already at maximum quantity in your cart.");return}this.showInventoryError(t,`Only ${d} more available. ${o.quantityAvailable} total in stock.`);return}this.cartManager.addUpsellItem({id:e,title:t,variant:"",price:r*a,quantity:a,variantId:o.id})&&console.log(`Added ${a}x ${t} to cart`)}showInventoryError(e,t){console.error(`Inventory Error for ${e}: ${t}`);let r=document.querySelector('[data-role="error"]');r&&(r.textContent=`${e}: ${t}`,r.classList.remove("hide"),setTimeout(()=>{r.classList.add("hide")},5e3))}};window.Webflow||(window.Webflow=[]);window.Webflow.push(async()=>{console.log("Webflow at src/events initialized");let e=document.querySelector("#event-meta")?.getAttribute("data-handle")||void 0,t=location.pathname.split("/").filter(Boolean).pop(),r=e||t||"",a=await Re(r);if(!a){console.error("[events] No product for handle",r);return}let o=document.querySelector('[data-role="cart"]'),i=new V,c=new D(i,o);i.onUpdateCallback=()=>{let m=a.variants?.edges?.[0]?.node?.price?.currencyCode||"USD";c.update(m)};let s=new _(a),l=new P(a,i),u=new U(a,i),d=new k(a,i,s,()=>l.getChosenVariantId());ze(a),await l.render(),await u.render(),d.setupFormHandler()});function ze(n){let e=(n.variants?.edges||[]).map(s=>s.node),t=e.reduce((s,l)=>s+(l.quantityAvailable||0),0),r=e.map(s=>Number(s.price?.amount||"0")).filter(s=>Number.isFinite(s)),a=r.length?Math.min(...r):null,o=r.length?Math.max(...r):null,i=e[0]?.price?.currencyCode||"USD",c=n.startTime?.value?new Date(n.startTime.value):null;c&&(b(document,"date",se(c)),b(document,"time",ce(c))),b(document,"gameType",n.gameType?.value||""),b(document,"format",n.format?.value||""),b(document,"duration",n.duration?.value?`${Number(n.duration.value)} min`:""),b(document,"seats",t>0?`${t} seats left`:"Sold out"),a!=null&&b(document,"priceRange",o!=null&&o!==a?`${g(a,i)} - ${g(o,i)}`:a===0?"Free":g(a,i))}})();
